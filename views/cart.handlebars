<main>
  <div class="container card">
    <section class="section my-5 pb-5">
      <!-- Shopping Cart table -->
      <div class="table-responsive">
        <table class="table product-table table-cart-v-1">
          <!-- Table head -->
          <thead>
            <tr>
              <th></th>
              <th class="font-weight-bold">
                <strong>Product</strong>
              </th>
              <th class="font-weight-bold">
                <strong>Description</strong>
              </th>
              <th></th>
              <th class="font-weight-bold">
                <strong>Price</strong>
              </th>
              <th class="font-weight-bold">
                <strong>QTY</strong>
              </th>
              <th class="font-weight-bold">
                <strong>Amount</strong>
              </th>
              <th></th>
            </tr>
          </thead>
          <!-- Table head -->
          <!-- Table body -->
          <tbody>
            {{#each cart.products}}
            <!-- Product row -->
            <tr>
              <th scope="row">
                <img src="/img/{{product.thumbnails.[0]}}" alt="img of {{product.title}}" class="img-fluid z-depth-0" />
              </th>
              <td>
                <h5 class="mt-3">
                  <strong>{{product.title}}</strong>
                </h5>
                <p class="text-muted">{{product.description}}</p>
              </td>
              <td>{{product.description}}</td>
              <td></td>
              <td>${{product.price}}</td>
              <td class="text-center text-md-left">
                <span class="qty">{{quantity}} </span>
                <div class="btn-group radio-group ml-2" data-toggle="buttons">
                  <label class="btn btn-sm btn-primary btn-rounded">
                    <input type="radio" name="options" id="option1" />&mdash;
                  </label>
                  <label class="btn btn-sm btn-primary btn-rounded">
                    <input type="radio" name="options" id="option2" />+
                  </label>
                </div>
              </td>
              <td class="font-weight-bold">
                <strong>${{multiply quantity product.price}}</strong>
              </td>
              <td>
                <button type="button" class="btn btn-sm btn-primary" data-toggle="tooltip" data-placement="top"
                  title="Remove item" onclick="deleteProduct('{{../cart._id}}', '{{this.product._id}}')">
                  X
                </button>
              </td>
            </tr>
            <!-- Product row -->
            {{/each}}
            <!-- Total row -->
            <tr>
              <td colspan="3"></td>
              <td>
                <h4 class="mt-2">
                  <strong>Total</strong>
                </h4>
              </td>
              <td class="text-right">
                <h4 class="mt-2">
                  <strong>${{total cart}}</strong>
                </h4>
              </td>
              <td colspan="3" class="text-right">
                <button type="button" class="btn btn-primary btn-rounded">
                  Complete purchase

                  <i class="fas fa-angle-right right"></i>
                </button>
              </td>
            </tr>
            <!-- Fourth row -->
          </tbody>
          <!-- Table body -->
        </table>
      </div>
      <!-- Shopping Cart table -->
    </section>
  </div>
</main>
<script src="/lib/helpers.handlebars.js"></script>
<script>
  async function emptyCart(cid) {
    try {
      const response = await fetch(`/api/cart/${cid}`, { method: 'DELETE' })
      const data = await response.json()
      console.log(data.message)
      window.location.href = "/"
      // Aquí podemos actualizar la página o mostrar un mensaje al usuario
    } catch (error) {
      console.error(error)
      // Aquí podemos mostrar un mensaje de error al usuario
    }
  }
  function deleteProduct(cid, pid) {
    fetch(`/api/cart/${cid}/products/${pid}`, { method: 'DELETE' })
      .then(res => {
        if (res.ok) {
          location.reload(); // recargar la página después de borrar el producto
        } else {
          throw new Error('Failed to delete product from cart');
        }
      })
      .catch(error => console.error(error));
  }
</script>